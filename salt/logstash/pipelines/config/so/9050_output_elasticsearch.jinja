{%- if grains['role'] == 'so-eval' -%}
{%- set ES = salt['pillar.get']('manager:mainip', '') -%}
{%- else %}
{%- set ES = salt['pillar.get']('elasticsearch:mainip', '') -%}
{%- endif %}
output {
 if [event][module] == 'elasticsearch' {
   elasticsearch {
     id => "elastic_logs"
     pipeline => "filebeat-%{[agent][version]}-elasticsearch-%{[fileset][name]}-pipeline"
     hosts => "{{ ES }}"
     index => "so-grid-%{+YYYY.MM.dd}"
     template_name => "so-common"
     template => "/templates/so-common-template.json"
     template_overwrite => true
     ssl => true
     ssl_certificate_verification => false
   }
 }
}
